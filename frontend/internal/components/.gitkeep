# Stage 1: Build
FROM golang:1.23 AS builder

WORKDIR /app

# Copy the build script and make it executable
COPY scripts/build.sh /app/scripts/build.sh
RUN chmod +x /app/scripts/build.sh

# Copy the rest of the application
COPY . /app

# Execute the build script
RUN /app/scripts/build.sh

# Stage 2: Run
FROM alpine:3.18

WORKDIR /app

# Copy binary from the build stage
COPY --from=builder /app/main /app/main

# Expose backend port
EXPOSE 8080

# Run the backend binary
CMD ["/app/main"]
